package com.example.demo;

import com.itextpdf.text.Document;
import com.itextpdf.text.Phrase;
import com.itextpdf.text.pdf.PdfPCell;
import com.itextpdf.text.pdf.PdfPTable;
import com.itextpdf.text.pdf.PdfWriter;
import org.springframework.boot.autoconfigure.SpringBootApplication;

import java.io.FileOutputStream;
import java.sql.*;

@SpringBootApplication
public class DbtopdfApplication {


    public static void main(String[] args) {

        try {
            /* Create Connection objects */
            Class.forName("com.mysql.cj.jdbc.Driver");
            Connection conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/test", "root", "manishavajhala");
            Statement stmt = conn.createStatement();
            ResultSet rs = stmt.executeQuery("select * from employee");
            ResultSetMetaData rsMetaData = rs.getMetaData();
            int count = rsMetaData.getColumnCount();

            Document document = new Document();
            PdfWriter.getInstance(document, new FileOutputStream("C:\\Users\\RSTPL0127\\Desktop\\EmployeeDetails.pdf"));
            document.open();

            PdfPTable pdfPTable = new PdfPTable(count);
            // Setting Headers
            for(int i = 1; i<=count; i++) {
                pdfPTable.addCell(rsMetaData.getColumnName(i).toUpperCase());
            }

            //create a cell object
            PdfPCell pdfPCell;

            while (rs.next()) {

                pdfPCell = new PdfPCell(new Phrase(rs.getString("id")));
                pdfPTable.addCell(pdfPCell);

                pdfPCell = new PdfPCell(new Phrase( rs.getString("name")));
                pdfPTable.addCell(pdfPCell);

                pdfPCell = new PdfPCell(new Phrase( rs.getString("city")));
                pdfPTable.addCell(pdfPCell);

                pdfPCell = new PdfPCell(new Phrase(rs.getString("country")));
                pdfPTable.addCell(pdfPCell);
            }
            /* Attach report table to PDF */
            document.add(pdfPTable);
            document.close();
            
            /* Close all DB related objects */
            rs.close();
            stmt.close();
            conn.close();
            System.out.println("downloaded successfully");
        } catch (Exception e) {
            throw new RuntimeException(e);
        }

    }
}