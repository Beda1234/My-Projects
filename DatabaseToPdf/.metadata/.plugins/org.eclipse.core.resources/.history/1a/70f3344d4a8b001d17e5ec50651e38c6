package com.example.main;

import java.io.FileOutputStream;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.Statement;

import org.springframework.boot.autoconfigure.SpringBootApplication;

import com.itextpdf.text.Document;
import com.itextpdf.text.Element;
import com.itextpdf.text.Font;
import com.itextpdf.text.FontFactory;
import com.itextpdf.text.Paragraph;
import com.itextpdf.text.Phrase;
import com.itextpdf.text.pdf.PdfPCell;
import com.itextpdf.text.pdf.PdfPTable;
import com.itextpdf.text.pdf.PdfWriter;
import com.itextpdf.text.PageSize;
import com.itextpdf.text.BaseColor;

@SpringBootApplication
public class DBtoPdfInSingleClass1Application {

	public static void main(String[] args) {
		try {
			/* Create Connection objects */
			Class.forName("com.mysql.cj.jdbc.Driver");
			Connection conn = DriverManager.getConnection("jdbc:mysql://localhost:3306/excel", "root",
					"bedaprakash123@");
			Statement stmt = conn.createStatement();
			ResultSet rs = stmt.executeQuery("select * from product");
			ResultSetMetaData rsMetaData = rs.getMetaData();
			int count = rsMetaData.getColumnCount();

			Document document = new Document(PageSize.A4);
			PdfWriter.getInstance(document, new FileOutputStream("C:\\Users\\RSTPL076\\Desktop\\DatabaseProduct.pdf"));
			document.open();

			// create a cell object
			PdfPCell pdfPCell = new PdfPCell();
			pdfPCell.setBackgroundColor(BaseColor.BLUE);
			pdfPCell.setPadding(5);

			Font font = FontFactory.getFont(FontFactory.HELVETICA_BOLD);
			font.setSize(18);
			font.setColor(BaseColor.BLUE);

			Paragraph paragraph = new Paragraph("List of Products", font);
			paragraph.setAlignment(Element.ALIGN_CENTER);
			document.add(paragraph);

			font.setColor(BaseColor.WHITE);
			font.setSize(9);
			PdfPTable pdfPTable = new PdfPTable(count);
//			pdfPTable.setWidthPercentage(100f);
//			pdfPTable.setWidths(new float[] { 1.0f, 1.5f, 1.0f, 1.0f, 1.0f, 1.0f, 1.0f });
//			pdfPTable.setSpacingBefore(10);
			float f=1.0f;
			for(int i=1;i<=count;i++) {
				
				
				pdfPTable.setWidthPercentage(100f);
				pdfPTable.setWidths(new float[] {f });
				pdfPTable.setSpacingBefore(10);
			}
			
			
			
			
			// Setting Headers
			for (int i = 1; i <= count; i++) {
				String columnNameee = rsMetaData.getColumnName(i);

				pdfPCell.setPhrase(new Phrase(columnNameee, font));
				pdfPTable.addCell(pdfPCell);
//                pdfPTable.addCell(rsMetaData.getColumnName(i).toUpperCase());
			}

			while (rs.next()) {

				pdfPCell = new PdfPCell(new Phrase(rs.getString("product_id")));
				pdfPTable.addCell(pdfPCell);

				pdfPCell = new PdfPCell(new Phrase(rs.getString("product_desc")));
				pdfPTable.addCell(pdfPCell);

				pdfPCell = new PdfPCell(new Phrase(rs.getString("product_name")));
				pdfPTable.addCell(pdfPCell);

				pdfPCell = new PdfPCell(new Phrase(rs.getString("product_price")));
				pdfPTable.addCell(pdfPCell);

				pdfPCell = new PdfPCell(new Phrase(rs.getString("product_discount")));
				pdfPTable.addCell(pdfPCell);

				pdfPCell = new PdfPCell(new Phrase(rs.getString("product_value")));
				pdfPTable.addCell(pdfPCell);

				pdfPCell = new PdfPCell(new Phrase(rs.getString("product_thing")));
				pdfPTable.addCell(pdfPCell);
			}
			/* Attach report table to PDF */

			document.add(pdfPTable);
			document.close();

			/* Close all DB related objects */
			rs.close();
			stmt.close();
			conn.close();
			System.out.println("downloaded successfully");
		} catch (Exception e) {
			throw new RuntimeException(e);
		}
	}

}
